#cloud-config

# --- 1. Определение источников метаданных ---
# NoCloud: используется, если вы подкладываете ISO или диск с конфигом вручную.
# None: отключает поиск метаданных в облаках (AWS, Azure, OpenStack), что ускоряет загрузку на 30-60 сек.
datasource_list: [ NoCloud, None ]

# --- 2. Управление именем хоста (Hostname) ---
# false: разрешает cloud-init перезаписывать имя хоста (если оно придет от DHCP или гипервизора).
preserve_hostname: false
# true: автоматическое обновление файла /etc/hosts при смене имени хоста.
manage_etc_hosts: true

# --- 3. Управление SSH-ключами сервера ---
# Удаление старых ключей эталонной машины при первой загрузке клона.
ssh_deletekeys: true
# Список типов ключей для автоматической генерации при первом запуске.
ssh_genkeytypes: ['rsa', 'ecdsa', 'ed25519']

# --- 4. Настройки аутентификации ---
# ssh_pwauth: разрешает вход по паролю через SSH. 
ssh_pwauth: true

# ==============================================================================
# ПРИМЕРЫ ДОПОЛНИТЕЛЬНЫХ НАСТРОЕК (Раскомментировать при необходимости)
# ==============================================================================

# --- Настройка часового пояса ---
# timezone: Europe/Moscow

# --- Создание пользователя с правами sudo ---
# users:
#   - name: operator
#     sudo: ['ALL=(ALL) NOPASSWD:ALL']
#     shell: /bin/bash
#     ssh_authorized_keys:
#       - ssh-rsa AAAAB3Nza... (публичный ключ)

# --- Установка пакетов при первой загрузке ---
# packages:
#   - qemu-guest-agent
#   - htop
#   - curl

# Автоматическая перезагрузка, если установленные пакеты этого требуют (например, ядро)
# package_reboot_if_required: true

# --- Выполнение команд при первом запуске (First Boot) ---
# runcmd:
#   - [ systemctl, enable, --now, qemu-guest-agent ]
#   - echo "Clone initialized on $(date)" >> /var/log/provision.log